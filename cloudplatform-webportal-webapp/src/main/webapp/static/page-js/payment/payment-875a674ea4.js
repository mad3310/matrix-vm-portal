function remainChose(){$(".self-checkbox").unbind("click").click(function(e){var t=$(this);t.hasClass("active")?($(".remainInput").css({transform:"translateY(-40px)",opacity:0,position:"absolute",transition:"all .5s ease-in"}),t.removeClass("active")):(t.addClass("active"),$(".remainInput").css({transform:"translateY(0px)",opacity:1,position:"relative",transition:"all .5s ease-in"})),alloptionsHandle()})}function moneyInputVali(){var e=!1,t=$(".remainPay"),a=$("#pay"),s=$(".error-desc"),r=/^-?\d+(\.\d{1,2})?$/,i=orderDetail();i.done(function(){var i=$("#orderpay").text(),n=$(".remain").text().substring(1),o=i>n?n:i;t.unbind("change").change(function(n){var d=t.val();return d?r.test(d)?0>d?(t.addClass("has-error"),s.text("输入不合法数字！请输入两位小数"),s.removeClass("hide"),a.attr("disabled","true")):d>o?(t.addClass("has-error"),s.text("支付金额有问题！"),s.removeClass("hide"),a.attr("disabled","true")):(d==o&&d==i?$(".payoption").removeClass("active"):$(".payoption:eq(0)").addClass("active"),t.removeClass("has-error"),s.addClass("hide"),a.removeAttr("disabled"),e=!0):(t.addClass("has-error"),s.text("输入不合法数字！请输入两位小数"),s.removeClass("hide"),a.attr("disabled","true")):$(".self-checkbox").hasClass("active")?(t.addClass("has-error"),s.text("输入不合法数字！请输入两位小数"),s.removeClass("hide"),a.attr("disabled","true")):(e=!0,t.removeClass("has-error"),s.addClass("hide"),a.removeAttr("disabled")),e})})}function moneyInput(){var e=!1,t=$(".remainPay"),a=$("#pay"),s=$(".error-desc"),r=/(^([1-9]\d*)(\.\d{1,2})?$)|(^0\.0[1-9]$)|(^0\.[1-9]\d*$)/,i=Number($("#orderpay").text()),n=Number($(".remain").text().substring(1)),o=i>n?n:i,d=t.val();return d?r.test(d)?0>d?(t.addClass("has-error"),s.text("输入不合法数字！请输入两位小数"),s.removeClass("hide"),$(".payoption").removeClass("active"),a.attr("disabled","true")):d>o?(t.addClass("has-error"),s.text("支付金额有问题！"),s.removeClass("hide"),$(".payoption").removeClass("active"),a.attr("disabled","true")):(-1===d.indexOf(".")?t.val(d+".00"):/\.\d$/.test(d)&&t.val(d+"0"),d==o&&d==i?$(".payoption").removeClass("active"):$(".payoption:eq(0)").addClass("active"),t.removeClass("has-error"),s.addClass("hide"),a.removeAttr("disabled"),e=!0):(t.addClass("has-error"),s.text("输入不合法数字！请输入两位小数"),s.removeClass("hide"),$(".payoption").removeClass("active"),a.attr("disabled","true")):$(".self-checkbox").hasClass("active")?(t.addClass("has-error"),s.text("输入不合法数字！请输入两位小数"),s.removeClass("hide"),$(".payoption").removeClass("active"),a.attr("disabled","true")):(e=!0,t.removeClass("has-error"),s.addClass("hide"),a.removeAttr("disabled")),e}function moneyInputFocus(){var e=$(".remainPay"),t=$("#pay"),a=$(".error-desc");e.removeClass("has-error"),a.addClass("hide"),t.removeAttr("disabled")}function payOptionChose(){$(".payoption").unbind("click").click(function(e){var t=$(this);t.hasClass("active")?t.removeClass("active"):t.addClass("active").siblings().removeClass("active"),alloptionsHandle()})}function rollup(){$(".title-rollup").unbind("click").click(function(){var e=$(".ordertable"),t=$(".icon-arrow01"),a=$(".rollup-text");e.hasClass("opacity")?(e.removeClass("opacity"),e.css({opacity:"0",transition:"opacity .2s ease-in"}),t.css({transform:"rotate(0deg)",transition:"transform .2s ease-in"}),a.text("展开")):(e.css({opacity:"1",transition:"opacity .2s ease-in"}),e.addClass("opacity"),t.css({transform:"rotate(180deg)",transition:"transform .2s ease-in"}),a.text("收起"))})}function userInfo(){var e=getCookie("userId"),t="/user/"+e;$.ajax({url:t,cache:!1,type:"get",success:function(e){var t=e.data;0==e.result?toastr.warning("","获取账户信息失败!"):$(".account").text(t.email)}})}function getCookie(e){for(var t=document.cookie.split("; "),a=0;a<t.length;a++){var s=t[a].split("=");if(s[0]==e)return s[1]}return""}function userRemainInfo(){var e=getCookie("userId"),t="/userAccount/balance/"+e;return $.ajax({url:t,cache:!1,type:"get",success:function(e){var t=e.data;0==e.result?toastr.warning("","获取账户余额失败!"):$(".remain").text("¥"+t)}})}function orderDetail(){var e=$("#orderNum").val(),t="/order/"+e;return $.ajax({url:t,cache:!1,type:"get",success:function(e){if(0==e.result)toastr.warning("","获取订单详情失败!");else{var t=$("#order-tbody");t.html("");var a,s=e.data,r=0,i="",n=0,o="",d="",c="",l="",u="";for(var v in s){var m="";a=s[v],r+=a.price,d=a.params.split("/;");for(var p in d)o=d[p],c=o.indexOf("/:"),l=o.substring(0,c),u=o.substring(c+2),m=m+'<div class="payitem clearfix"><div class="text-right">'+l+'&nbsp;:</div><div class="payitem-desc">&nbsp;'+u+"</div></div>";n+=a.orderNum,i=i+'<tr><td></td><td><div style="width:50%;text-align:right;">'+a.productName+"</div></td><td>"+a.orderNum+"</td><td>"+a.orderTime+'个月</td><td class="price">¥'+a.price+'</td></tr><tr><td></td><td><div class="payitems">'+m+"</div></td><td></td><td></td><td></td></tr>"}var y="<tr><td>"+s[0].orderNumber+'</td><td><div style="width:50%;text-align:right;">云服务产品</div></td><td>'+n+"</td><td>"+s[0].orderTime+'个月</td><td class="price">¥'+s[0].totalPrice+"</td></tr>";t.append(y),$("#orderpay").text(r.toFixed(2));var h=userRemainInfo();h.done(function(e){Number(e.data)>=Number(r)?$(".remainPay").val(r.toFixed(2)):($(".remainPay").val(e.data),$(".payoption:eq(0)").addClass("active")),$(".remainPay").blur()}),t.append(i)}}})}function alloptionsHandle(){var e=$("#pay"),t=Number($("#orderpay").text()),a=$(".remainPay").val(),s=$(".alloption.active");s.length>0?s.length>1?e.removeAttr("disabled"):s.hasClass("self-checkbox")?a==t?e.removeAttr("disabled"):e.attr("disabled","true"):e.removeAttr("disabled"):e.attr("disabled","true")}function goPay(){var e=document.body.scrollWidth,t=$("#orderNum").val(),a=$("#redirect").val(),s=orderDetail();$("#pay").unbind("click").click(function(a){s.done(function(){var a=Number($("#orderpay").text()),s=$(".remainPay").val(),r=a-s,i=$(".alloption.active"),n={0:"/pay/"+t+"?accountMoney="+s,1:"/pay/"+t+"?pattern=1",2:"/payment/wxpay?orderNum="+t+"&money="+a+"&accountMoney=0","01":"/pay/"+t+"?pattern=1&accountMoney="+s,"02":"/payment/wxpay?orderNum="+t+"&money="+r.toFixed(2)+"&accountMoney="+s},o="";i.length>0&&$.ajax({url:"/order/pay/"+t,cache:!1,type:"get",success:function(t){var a=document.body.scrollHeight;if(0==t.result)toastr.warning("","获取订单信息失败!");else if(1==t.data.status)$(".modal-container").find(".modal-title .title").text("温馨提示"),$(".modal-container").find(".modal-content .content-desc").text("长时间未支付，订单已失效"),$(".modal-container").find(".modal-content .paybtns").html('<button class="btn btn-le-blue paybtn">确定</button>'),$(".modal-container").css({width:e,height:a}).removeClass("hide");else if(0==t.data.status){o=i.length>1?0==r?"0":"0"+$(".payoption.active").attr("self-payoption"):$(".alloption.active").attr("self-payoption");var s=n[o];window.open(s),$(".modal-container").css({width:e,height:a}).removeClass("hide")}else $(".modal-container").find(".modal-title .title").text("温馨提示"),$(".modal-container").find(".modal-content .content-desc").text("订单已支付成功，请勿重复操作"),$(".modal-container").find(".modal-content .paybtns").html('<button class="btn btn-le-blue paybtn">确定</button>'),$(".modal-container").css({width:e,height:a}).removeClass("hide")}})})}),$(".paybtns").unbind("click").click(function(e){var s=e.target||e.srcElement,r=$(s);r.hasClass("paybtn")&&$.ajax({url:"/order/pay/"+t,cache:!1,type:"get",success:function(e){var s="/cvm/#/vm";0==e.result?toastr.warning("","获取订单信息失败!"):2==e.data.status?$.ajax({url:"/order/serviceStatus/"+t,type:"get",cache:!1,success:function(e){0==e.result?toastr.warning("","获取服务创建信息失败!"):(e.data||(document.cookie="serviceStatus"+a+"=notready"),redirects[a]&&(s=redirects[a]),window.location.href=s,$(".modal-container").addClass("hide"))}}):1==e.data.status?(redirects[a]&&(s=redirects[a]),window.location.href=s,$(".modal-container").addClass("hide")):$(".modal-container").addClass("hide")}})}),$(".icon-add").unbind("click").click(function(e){$(".modal-container").addClass("hide")})}function queryStatus(){var e=$("#orderNum").val(),t=$(".desc-tip"),a=$("#payNum"),s="";return $.ajax({url:"/order/pay/"+e,cache:!1,type:"get",success:function(e){if(t.html(""),0==e.result){var r=e.msgs?e.msgs:"获取订单支付信息失败";toastr.warning("",r)}else{var i=e.data;0==i.status?s='<div class="successicon fail"></div><div  class="desc-success">支付处理中...</div>':(s='<div class="successicon"></div><div  class="desc-success">支付成功</div><div class="desc-pay">恭喜您成功支付¥<span class="price">'+i.totalPrice+"</span>元</div>",a.text("支付订单号："+i.payNumber)),t.append(s)}}})}function timeStatus(){var e=$(".desc-tip"),t=queryStatus();t.done(function(a){var s=0,r="";0==a.data.status&&(r=setInterval(function(){t=queryStatus(),t.done(function(t){if(s+=4,0==t.data.status)s>=10&&(e.children("div:eq(1)").text("支付不成功！"),clearInterval(r));else{e.html("");var a='<div class="successicon"></div><div  class="desc-success">支付成功</div><div class="desc-pay">恭喜您成功支付¥<span class="price">'+t.data.totalPrice+"</span>元</div>";clearInterval(r),e.append(a)}})},3e3))})}var redirects={2:"/cvm/#/vm",3:"/cvm/#/vm-disk",4:"/cvm/#/vm-floatIP",5:"/cvm/#/vm-router",renew:"https://lcp-uc.letvcloud.com/uc/renew/getRenewView.do"};