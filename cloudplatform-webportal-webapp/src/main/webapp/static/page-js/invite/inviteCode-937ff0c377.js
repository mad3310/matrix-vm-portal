function codeimgClick(){var e=$(".vali-codeimg");e.unbind("click").click(function(a){e.hide().attr("src","/kaptcha?random="+100*Math.random()).fadeIn()})}function inviteVali(e){var a=!1,t=/^[a-zA-z0-9]{12}$/;return t.test(e.val())?(a=!0,e.removeClass("has-error").next(".error-msg").addClass("hide")):e.addClass("has-error").next(".error-msg").removeClass("hide").text("邀请码格式错误"),a}function codeVali(e){var a=!1,t=e.val();return $.ajax({url:"/kaptcha",async:!1,type:"post",data:{kaptcha:t},success:function(t){t.data?(a=!0,e.removeClass("has-error").next().next(".error-msg").addClass("hide")):(a=!1,$(".vali-codeimg").attr("src","/kaptcha?random="+100*Math.random()),e.addClass("has-error").next().next(".error-msg").removeClass("hide").text("验证码错误，请重新输入"))}}),a}function totalValify(){var e=!0,a=inviteVali($(".inviteCode")),t=codeVali($(".valicode-input"));return a&&t||(e=!1),e}function ifneedcode(){return $.ajax({url:"/kaptcha/isNeed",type:"get",success:function(e){var a=$("#valicode");e.data?a.removeClass("hide"):a.addClass("hide")}})}function inviteBtnClick(){$(".invitebtn").unbind("click").click(function(e){var a=$(".inviteCode").val(),t=$(".valicode-input").val(),i="",r=ifneedcode();r.done(function(e){e.data?($("#valicode").removeClass("hide"),totalValify()&&(i={inviteCode:a,kaptcha:t},inviteajax(i))):($("#valicode").addClass("hide"),$("#idcode").attr("src",""),inviteVali($(".inviteCode"))&&(i={inviteCode:a},inviteajax(i)))})})}function inviteajax(e){var a="",t=$("#idcode"),i=$(".blockInputs"),r=$(".blockSuccess"),s=$(".inviteCode");$.ajax({url:"/inviteCode/verify",type:"post",data:e,success:function(e){0==e.data?(t.attr("src")&&t.attr("src","../kaptcha"),i.removeClass("hide"),r.addClass("hide"),s.addClass("has-error").next(".error-msg").removeClass("hide").text(e.msgs)):1==e.data?(s.removeClass("has-error").next(".error-msg").addClass("hide"),i.addClass("hide"),r.removeClass("hide"),a?clearTimeout(a):a=setTimeout(function(){window.location.href="http://lcp.letvcloud.com/profile"},2e3)):(t.attr("src")&&t.attr("src","../kaptcha"),i.removeClass("hide"),r.addClass("hide"),s.addClass("has-error").next(".error-msg").removeClass("hide").text(e.msgs))}})}